Jeff Going to reverse engineer the explanation of DFT:

Talk about why need functionals to deal with inhomogenous situations.
Then talk about how functional deriviatives are taken.

\section{Classical Density Functional Theory}

A statistical ensemble is a collection of an arbitrary number of
systems that have the same macroscopic properties and internal
restrictions, but have positions and momenta that are otherwise
distributed randomly.  In the canonical ensemble, the number of
particles $N$, the total volume of the system $V$, and the tempurature
$T$ are taken as constant.  In this ensemble the free energy, defined
as $F = U - TS$, where $U$ is the internal energy and $S$ is the
entropy of the system, is  minimized in thermodynamic equilibrium. In
the grand canonical ensemble, the number of particles is allowed to
vary while $V$, $T$ and the chemical potential $\mu$ are held constant.
In this ensemble it is the grand potential, defined as $\Omega = F -
\mu N$, that is minimized in thermodynamic equilibrium.

In the case of inhomogenous fluids, an inhomogenous external potential
$\phi(\rr)$ restricts the particles in the system and takes the place
of the volume $V$ in the thermodynamic equations.  In such a system, a
change in the internal energy is given by
\begin{align}
  \delta U = T\delta S + \int \rho^{(1)}\delta \phi(\rr)d(\rr) + \mu \delta N
\end{align}

In the grand canonical ensemble, the probability density
$f_0(\rr^N,\mathbf{p}^N;N)$ is defined so that
$f_0(\rr^N,\mathbf{p}^N;N)d\rr^N$ is the probability that there are
$N$ particles in the system and that those particles are found within
the infinitesimal range of positions $\rr^N$ and momenta
$\mathbf{p}^N$.  It's definition is
\begin{align} \label{eq:prob-density}
  \mathit{f}_0(\rr^N,\mathbf{p}^N;N) = \frac{exp(-\beta(\mathcal{H}-N\mu))}{\Xi}
\end{align}
where
\begin{align}
  \Xi = \sum_{N=0}^{\infty}\frac{exp(N\beta\mu)}{h^{3N}N!}\int\int exp(\beta \mathcal{H})d\rr^Nd\mathbf{p}^N
\end{align}
is the partition function of the grand canonical
ensemble. Eq.~\ref{eq:prob-density} is structured as the boltzmann
constant with an energy argument comprised of the Hamiltonian and
chemical potential, divided by the grand partitian function.

Classical Density Functional Theory assumes that the hamiltonian can
be split into linearly combined parts:
\begin{align}\label{eq:hamiltonian}
  \mathcal{H}(\rr^N,\mathbf{p}^N) = K_N(\mathbf{p}^N) + V_N(\rr^N) + \Phi(\rr^N)
\end{align}
The three terms on the right are the kinetic energy, potential
interaction between particles, and external potential, respectively.
The kinetic energy depends soley on the momenta of the particles, and
the two potentials soley on their positions.

Substituing this into the Hamiltonian term in
Eq.~\ref{eq:prob-density} and taking the natural logarithm, we have:
\begin{align}
  \ln \mathit{f}_0 = \beta\Omega - \beta K_N - \beta V_N - \beta \Phi_N + N\beta \mu
\end{align}
where we have used the relation
\begin{align}
  \Omega = -k_BT\ln\Xi
\end{align}
which is the basic connection between thermodynamics and statistical
mechanics in the grand canonical ensemble.

Because the external potential and $\mu$ both don't change and
$\rho^{(1)}(\rr)$ is the average ensemble equilibrium density at
$\rr$, it's true that
\begin{align}
  \langle \Phi_N \rangle = \int \rho^{(1)}(\rr)\phi(\rr)d\rr \
  and \
  \langle N\mu \rangle = \mu \int \rho^{(1)}(\rr) d\rr
\end{align}

Using these relations and switching terms around in Eq.~{}results in the equation
\begin{align} \label{eq:intrinsic-free-two}
  \langle K_N + V_N + k_BT \ln \mathit{f}_0 \rangle \
  = \Omega - \int \rho^{(1)}(\rr)\phi(\rr)d\rr + \mu \int \rho^{(1)}(\rr)d\rr
\end{align}


Switching around the definition of the thermodynamic grand potential
gives us $F = \Omega + \mu N$.  We can see the right hand side of
Eq.~\ref{eq:intrinsic-free-two} is analougous to the free energy of the
inhomogenous system minus the part given by the external potetnial.
We call this function the 'intrinsic free energy' $\iF$ since it
addresses the interactions between the particles within the system:

\begin{align}
  \iF = \Omega - \int \rho^{(1)}(\rr)\phi(\rr)d\rr + \mu \int \rho^{(1)}(\rr)d\rr \
  = \langle K_N + V_N + k_BT \ln \mathit{f}_0 \rangle
\end{align}

It can be shown that for a given $\mu$, $T$, and defined function
$V_N$ describing the potential interaction between particles, there is
a one-to-one relation between the external potential function and the
equilibrium density profile $\rho^{(1)}$ at thermodynamic equilibrium.
The grand canonical density function $f_0$ (Eq.~\ref{eq:prob-density})
for a given function $V_N$, $\mu$, and $T$ is a function of external
potential, so that the right hand side of
Eq.~\ref{eq:intrinsic-free-two} is a function of external potential
and therefore also of $\rho^{(1)}$.  Thus intrinsic free energy $\iF$
is dependent on $\rho^{(1)}$.


We can thus write
\begin{align}
  \Omega_{\phi}[n] = \iF[n] + \int n(\rr)\phi(\rr)d\rr - \mu\int n(\rr)d\rr
\end{align}
At equilibrium, this grand potential is minimized.


The first step in Classical Density Functional Theory is to design the
functional form of the intrinisic free energy $iF$, which is
conceptually equal to the free energy ignoring the external potential.
We then set the tempurature $T$, chemical potential $\mu$, and
external potential $\phi(\rr)$, and adjust the density profile until
we have found the global minimum of this grand potential.  The result
is the density and grand potential in equilibrium.


(the statistical average of $V_N$
depends on $\rho^{(1)}$ since $V_N$ initially defined by $V_N(r^N)$ in
Eq.~\ref{eq:hamiltonian}, so a function of positions of particles, so
statistical average version is above).

Is the configuration integral, it's the potential's contribution to the partitionn function

This is the functional version of grand potential, dependent upon
$n(\rr)$, not neccesarily the equilibrium $n(\rr)$, and this will be
minimized in the case of thermodynamic equilibrium.
\begin{align}
  \Omega_{\phi}[n] = \iF[n] + \int n(\rr)\phi(\rr)d\rr - \mu\int n(\rr)d\rr
\end{align}


n-particle density in the grand canonical ensemble is:
\begin{align}
  \rho_N^{(n)}(\rr^n)=\frac{1}{\Xi}\sum^{\infty}_{N=n}\frac{exp(N\beta \mu)}{\Lambda^3 (N-n)!} \
  \int exp(-\beta V_N)d\rr^{(N-n)}
\end{align}
where the spatial integral of the Boltzmann factor is taken over all
the potential interaction with all the other particles $N$ in the
system, and all the possible $N$s are considered. The $exp(N\beta
\mu)$ boltzmann term accounts for the chemical potential's regulation
of the average number of particles in the system.  It is defined so
that an integral of the single particle density gives the average
number of particles:
\begin{align}
  \rho_N^{(1)}(\rr)d\rr = \langle N \rangle
\end{align}



canonical ensemble:
\begin{align}
  F = U - TS
\end{align}


grand canonical ensemble:
\begin{align}
  \Omega = F - N \mu
\end{align}

The second term on the right hand side normally vanishes, since the
external potential is usually a wall, so either infinity or zero, and
if it's infinity, than $n(\rr)$ there is zero.




%% \begin{figure}\caption{Smart figure}
%% \end{figure}

%% \begin{table}\caption{Smart table}
%% \end{table}

%% \section{a section}
%% I am referencing a figure~\ref{fig:fig-ref}

%% \section{a different section}
I am citing a source~\cite{huang2003dynamic}
\clearpage
\newpage

Important to note that the functional your minimizing is not the grand potential until its minimized



\section{Introduction to SAFT and explanation of first free energy term}


Work on classical Density Functional Theory for fluids involves
creating intrinsic density functionals of the density profile.  These
are comprised of a sum of terms that individually address different
conceptual aspects of the system.   terms that treat different types
of interaction between particles are added to terms that describe
reference system.  For example, the functional for the version of SAFT
that we use in our work, is defined as

\begin{align}
  iF_{SAFT} = F_{ideal} + F_{hard sphere} + F_{something}
\end{align}

We will discuss in much more detail the meaning of these terms below,
but write it down now to illustrate the general structure of the total
functional.


While our contributions described in the next chapters could certainly
be applied to many different types of fluid functionals, we
specifically worked towards improving the very popular SAFT versions
functionals in current development.  Indeed in one of the papers
described, we use the function we've created within a SAFT functional
to test it's affect upon the results of the that functional.
Therefore while describing the general background and origin of the
ideas we use, I'll speak directly to the build up of the SAFT
functional, the pieces of which (developed and verified by others) and
the general structure are found in many other functionals.


The first two terms, $F_{ideal}$ and $F_{hard sphere}$
define the reference system.  The rest of the terms address different
approximations of interactions (which we describe below).  In in
homogenous fluids, each one of these terms is itself a functional of
the density profile.

Many times different approaches will use the same reference systems
and even the exact functional form of the reference system free energy
terms while, when treating other forms of interaction, will use
different conceptual models and implementation in order to construct
those terms.  SAFT itself departs from other theories in it's last
three terms.  The first 'ideal' term it uses is ubiquitous, and the
second is a particularly common reference system for fluids.  I give a
detailed introduction to the particular functional that we use for it
below (that of the White Bear free energy), because while we don't
actually modify it in our implementation of inhomogenous SAFT, we do
draw heavily from its ideas when creating the function that we do.

The first term in the SAFT functional is the ideal free energy term
$F_{ideal}$.  This term treats a system of particles that do not
interact with eachother.  This is an obvious place to start if one is
to build the description of particle interaction terms upon a
reference system.  It's lack of interaction actually causes this term
to be the only one that we can construct exactly, with no
approximations.  To see why, we point out that a system of non
interacting spheres is able to satisfy the local density apporximation
(only here it is not an approximation!)  The local density
approximation states that a free energy functional can be written as
an integral of a completely local function of the density profile.
For example,
\begin{align}
  \iF_{local~density}[\rho^{(1)}] = \int f(\rho^{(1)}) d\rr
\end{align}

where $f(\rho^{(1)})$ is the free energy per unit volume of the
homogenoues fluid at a density $\rh$.  This approximation neglects any
interaction between the particles, so that any spatial variation in
the density will be due entirely to the varying external potential.
In essence, each bit of volume becomes it's own thermodynamic system,
with a free energy equal that of a homogenous density of particles,
and the free energies from all the bits of volume are added up to get
the total.  This approximation has also been used to construct entire
intrinsic free energy functional (cite). In fact it does apply to
external potentials that modulate the density slowly over space, much
more slowly than correlation lengths.  The approximation breaks down
rather quickly, however, near hard walls for interacting systems,
where often the spheres will stack up in 'layers' (should see some
figure) and the densities are higher than bulk freezing densities
(cite).

However, the ideal term can be constructed in this fashion, so all we
need to do is integrate the free energy of an ideal homogenous system
at the local density.  Going back to basic thermodynamics and
statistical mechanics, we have:
\begin{align}
  F = -k_BT \ln Q_N = -k_BT \ln (\frac{V}{N!\Lambda^3})
\end{align}
where $Q_N$ is the partition function and $\Lambda$ is de Broglie
thermal wavelength.  Using th Stirling approximation for $N!$, we have
\begin{align}
F^{id} = Nk_BT(\ln \Lambda^3 \rho - 1))
\end{align}

Taking this as the free energy per unit volume and integrating, we
have
\begin{align}
  \beta \iF[\rho] = \int d\rr \rho(\rr)(\ln (\Lambda^3\rho(\rr))-1)
\end{align}

Because this term is in fact an exact one for the ideal gas, it is
ubiqitous in the use of classical density functional theory for
inhomogeneous and homogeneous fluids.

\clearpage
\newpage

\section{Virial Equation, Mayer functions, and the Carnahan Starling Equation}

The second term in the SAFT intrinsic free energy functional,
$f_{hard~sphere}$, is also a reference term and is used in many other
functionals besides the one described here.  I'll introduce the term
and the theory behind it in some detail in the next section because it
is so widely used and, more importantly, because an understanding of
the ideas involved is neccesary for an understanding of our own work.
Before describing the term itself, however, I'll explain here some
important things that lead up to this theory, namely the Virial
equation, Mayer functions, and the Carnahan Starling Equation.

The Virial Equation applies to homogeneous fluids.  It equates a
thermodynamic, intensive quantity (likes the pressure) with an
expansion of the homogeneos density of the fluid.  It's standard form
is
\begin{align}
  \frac{\beta P}{\rho} = 1 + \sum_{i=1}^{\infty}\beta_i\eta^i.
\end{align}

The expansion comes out of a formulation of the partition function
that is most often expressed as a series of diagrams that have well
defined rules of construction.  I won't explain the diagrams or their
rules here, but Figure(REF) shows an example so that if the reader
sees them somewhere she'll know what they are.  A single term (or
diagram) in this expansion of the partition function is in fact a
spatial integral of an integrand composed of particle densities
multiplied by a number of what are called Mayer Functions.  To
explain, I'll start with the partition function:
\begin{align}
  \Xi &= \sum_{N=0}^{\infty}\frac{exp(N\beta\mu)}{h^{3N}N!}\int...\int exp(\beta \mathcal{H})d\rr^Nd\mathbf{p}^N \\
  &=\sum_{N=0}^{\infty}\frac{exp(N\beta\mu)}{h^{3N}N!}\int...\int exp(-\beta (V_N + \phi(\rr))d\rr^Nd\mathbf{p}^N
\end{align}
where $V_N$ is the interaction potential between all the particles in
the system and $\phi(\rr)$ is the external potential.  If the the
interaction potential can be written as a summation of pairwise
superposable interactions, i.e.
\begin{align}
  V_N = \sum_{i<j}^{all~particles} v(i,j)
\end{align}
 than the partition function can be written as
\begin{align}
  \Xi = \sum_{N=0}^{\infty}\frac{1}{N!}\int... \int \left(\overset{N}{\underset{i<j}{\Pi}} f(i,j)\right)
  \left( \overset{N}{\underset{i=1}{\Pi}} \frac{exp(\beta (\mu - \phi(\rr)))}{\Lambda^3}\right)d\rr^N
\end{align}
where $f(i,j)=exp(-\beta v(i,j))$ is the Mayer function between two
particles.  With the help of the diagrams, one can take the natural
logarithm of this function to get the grand potential, and then
derivatives to find what are called direct correlation functions
(which I won't explain here). The use of an identity yields a
relationship between the chemical potential and the density:
\begin{align}
  \beta \mu = \beta \mu^{id} - \sum_{i=1}^{\infty}\beta_i\rho^i
\end{align}
Then the use of the following relation from thermodynamics:
\begin{align}
  \left(\frac{\partial P}{\partial \rho}\right)_T \
  = \rho \left(\frac{\partial \mu}{\partial \rho}\right)_T
\end{align}
allows one to express the pressure as
\begin{align}
  \frac{\beta P}{\rho} = 1 + \sum_{i=1}^{\infty}\beta_i\eta^i
\end{align}
where
\begin{align}
  \label{eq:virial-coeff}
  \beta_i = (\frac{6}{\pi d^3})^i B_{i+1}
\end{align}


(REWRITE BELOW)
The above formulation of a thermodynamic property is useful, but it
requires an expansion of coeffients, which can be a nuisance
computationally.  Caranahan and Starling (cite) were able to develop a
rule for coefficient generation that approximates
Eq.~\ref{eq:virial-coeff}, but that results in integers, and ones that
one can allow for a geometric the one written above, based on and then
multiple terms of a The virial coefficients $\beta_i$ based on the
procedure above are not integers, so in order to get get to a
thermodynamic property the series must be expanded.  Carnahan Starllng
constructed a method that allows them to approximate each coefficient
by a very close integer in a sysematic fashion that allows them to
create a geometric series.  This series yields a simple, analytic
approximation of the pressure in the homogenous fluid as a function of
density 3.9.17


\begin{align}
  \frac{\beta P}{\rho}=\frac{1+\eta+\eta^2-\eta^3}{(1-\eta)^3}
\end{align}
or for the free energy:
\begin{align}
  \frac{\beta F^{ex}}{N}=\frac{\eta(4-3\eta)}{(1-\eta)^2}
\end{align}

Its is very successful in predicting pressure of homogenous hard
sphere fluid at different densities.

White Bear uses MCSL equation of state, which is the generalization to
the multi component mixture of hard spheres of the Carnahan-Starling
equation of state.  We describe the Carnahan-Starling equation of
state here because we use it in the first chapter.





\section{$F_{hard~sphere}$, Fundemental Meaure Theory, and White Bear}

We now return to analyzing the terms within SAFT:
\begin{align}
  F_{SAFT} = F_{ideal} + F_{hard~sphere} + F_{other terms}
\end{align}

Remember that $F_{ideal}$, because it treats particles that do not
interact with one another, can be described as an intagral of a purely
local free energy function over the volume of the system.  In fact,
this one term addresses any aspect of the system that is
non-interactive, in the sense that every other term in $F_{SAFT}$ is
designed to specifically deal with a different type of potential
interaction among the particles.  Thus, $F_{ideal}$ is in a sense the
most basic reference term in the system.  However, as I've explained
above, the seconds term, $F_{hard~sphere}$, which we will describe here,
is also considered to be a reference system.

The potential interaction it describes is based on the fact that every
particle has at it's core a 'hard-core' repulsion to any other
particle.  In other words, as two particles approach each other in
space, there is a sudden, sharp spike in potential that prevents the
two particles from 'overlapping'.  The forces here can be complicated,
deriving from nuclear forces and the exclusion principle, but our
classical theories seek to approximate these in simple ways.  

The hard sphere potential interaction is characterised by an
impenetrable spherical volume that is centered at a particles'
position.  The potential between two of these hard spheres discontinuously jumps from zero to infinity when the
spheres are a distance apart that is equal to their combined radii:
\begin{align}
  v(r) &= \infty,~~ r < r_A + r_B \\
  &= 0,~~ r > r_A + r_B
\end{align}
where $r$ is the distance between the two particles, and $r_A$ and
$r_B$ are the radii of the two particles.  This hard sphere potential that we use is not the only commonly used method for treating the hard-core repulsion between particles.  The Leonard-Jones potential,
for example, another widely used potential energy description, approximates the
repulsion with a positive term porportional to $\frac{1}{r^{12}}$



Once we decide upon a form for the potential, we must turn to the much more difficult step of designing a free energy functional that is appropriate for hard sphere particles.  One of the first methods by which people attempted to deal with these interactions (not limited to hard spheres) was to modify the form of the local density approximation free energy discussed above, 
\begin{align}
  \iF_{local~density}[\rho^{(1)}] = \int f(\rho^{(1)}) d\rr
\end{align}
to incorporate information about the particle densities immediately surrounding each point.  They did this by redefining the density at each point to be a convolution of the surrounding density with a weighting function:
\begin{align}
  \label{eq:convolution-of-density}
  \bar{\rho}(\rr) = \int w(|\rr-\rr'|) \rh(\rr') d\rr'
\end{align}
and then integrating this density over space to get the total free energy, in the same fashion (NOT THE SAME LOOK AT EQUATION) as the local density approximation:
\begin{align}
  \iF[\rh] = \int \frac{f^{ex}(\bar{\rho})}{\bar{\rho}} \rh(\rr') d\rr'
\end{align}
Eq.~\ref{eq:convolution-of-density} allows one to shape the approximately interaction, in a sense, by changing the structure of the weighting function.  For example, if one were to choose for the weighting function the step function $\Theta(|\rr-\rr'|)$, than the modified density would incorporate in an equal way all the density within a sphere surrounding the particle.  This is an extremely simple example of a weighted density approximation.  Practical theories formulated in this manner become very complicated.  We introduce it here so that the reader knows what it is and also because the central idea described by Eq.~\ref{eq:convolution-of-density} is used in FMT as well. 

Fundamental Measure Theory, created by Rosenfeld in 1989, also defines the free energy in terms of a series of convolutions of densities, but it is a considerable departure from the weighted density approximation theories.  It is based on an involved derivation worked out by Perkis and Yevik in (YEAR) of an equation of state for a homogeneous fluid.   Like the derivation of the Virial Expansion and Carnahan-Starling Equation discussed above, this derivation also dealt with correlation functions and ultimately expressed thermodynamic properties in terms of homogeneous density.  Comparing this theory with the derivations of another theory call Scaled
Particle Theory, which once again I will not explain but will say
that it has to do conceptually with a system of spheres and a growing cavity in which they are not allowed to go, Rosenfeld recognized that the density sides of the Perkis-Yevick 
equations can be reformulated in terms of convolutions
of functions that are constructed to describe the geometric
properties of spheres.  He then discovered that for inhomogeneous
systems, he could write down the intrinsic free energy in terms of
convolutions of densities with these functions in such a way
that the Percis-Yevik correlation equations were reproduced in the limit of homogeneous density.  The derivation is certainly an involved (and brilliant) one, and there is actually another derivation to get to the same place introduced by (TARAZONA? ) in (YEAR) that is thought by some to be more elegant.  However I don't use any ideas that are directly pulled from these derivations in my work, besides those that can be taken from the general characteristics (spherical nature) of the resulting Free Energy functional.   

The result of all this is an intrinsic free energy which neccasarily has the form:
\begin{align}
  \label{eq:F-FMT-form}
  \iF_{hard~sphere}[\rho^{(1)}] = \int \Phi({n_i(\rr')})d\rr'
\end{align}
The integrand $\Phi$ here is a local function of $n_i(\rr)$, which are the non-local convolutions of density with sphere-like weighting functions discussed above.  In FMT they are referred to as 'fundamental measures'.  They are defined as:
\begin{align}
  n_3(\rr) &= \int n(\rr') \Theta(\sigma/2 -\left|\rr - \rr'\right|)
  d\rr' \label{eq:FMn3} \\
  n_2(\rr) &= \int n(\rr') \delta(\sigma/2 -\left|\rr - \rr'\right|) d\rr' \\
  \mathbf{n}_{2V}(\rr) &= \int n(\rr') \delta(\sigma/2 -\left|\rr - \rr'\right|) \frac{\rr-\rr'}{|\rr-\rr'|}d\rr'
\end{align}
\begin{align}
  \mathbf{n}_{V1} = \frac{\mathbf{n}_{V2}}{2\pi \sigma}, \quad
  n_1 &= \frac{n_2}{2\pi \sigma} , \quad
  n_0 = \frac{n_2}{\pi \sigma^2} \label{eq:FMrest}
\end{align}
We can see the spherical nature of the theory by inspecting the $n_i$.  The $n_3(\rr)$ weighting function is a step function that is designed so that the density is integrated over the volume of a sphere of radius $\sigma/2$, but will make no contributions outside of this sphere.  $n_2$ only allows for integration of densities on the surface of a sphere, but incorporates no density within or outside of it.  $n_{2V}$ is a vector version of $n_2$, and the others are different versions of the same, modified to have different units. 
  
The form of $\Phi({n_i(\rr)})$ is restricted to a certain extent by dimensional analysis (the units of each term have to be right!) throughout the derivation, but even given this the theory allows for a certain amount of freedom in it's design.  Since his derivation of FMT was originally based on concepts in the Perkis-Yevik derivation of the equation of state, Rosenfeld constructed the form of his functional so that in the limit of homogeneous density, the free energy of the system approaches that given by the Perkis-Yevik equation of state.  

While the theory has been a resounding success (MAYBE MENTION HOW SUCCESSFUL IN BEGINNING OF SECTION), the use of the Perkis-Yevik equation of state as the underlying, homogeneous limit equation causes some problems.  For the hard sphere fluid this equation predicts a pressure that is too high as bulk freezing tempuratures are approached.  At the same time, the construction of FMT obeys a theorem called the 'contact value theorem,' which states that the pressure at a wall is equal to the temperature multiplied by the density in contact with that wall, $p=kT\rho_{contact}$.  This theorem is very important to our own work and I will discuss it in detail below, but I mention it now to say that the Perkis-Yevik equation consequently overestimates the density at contact at  freezing bulk temperatures.  This is problematic, since much of the reason we use classical density functional theory in analyzing inhomogeneous fluids in the first place is to estimate what happens at walls! 

In (YEAR) Roth et al addressed this issue in their version of FMT which they named 'White Bear', anecdotally after a pub that they frequented while writing the theory.  They keep the same general form of Rosenfeld's FMT but adjust it so that in the limit of homogeneous density it's free energy approaches that of the Mansoori-Carnahan-Starling-Leland equation, a modified version of the Carnahan-Starling equation of state, which we discussed above and which we use directly in our own work.  The Carnahan-Starling is more accurate in limiting cases than the Perkis-Yevik, so that the White Bear hard-sphere free energy functional, $F_{hard~sphere}$, is overall a more accurate one.  It is therefore the hard sphere free energy reference system that we choose to use in our own work.   

Below is the entire energy functional written in terms of the fundamental measure, $n_i(\rr)$:
\begin{equation}
F_\textit{hard~sphere}[n] = k_B T \int \left(\Phi_1(\rr) + \Phi_2(\rr) + \Phi_3(\rr)\right) d\rr \; ,
\end{equation}
with integrands
\begin{align}
\Phi_1 &= -n_0 \ln\left( 1 - n_3\right) \label{eq:Phi1}\\
\Phi_2 &= \frac{n_1 n_2 - \mathbf{n}_{V1} \cdot\mathbf{n}_{V2}}{1-n_3} \\
\Phi_3 &= (n_2^3 - 3 n_2 \mathbf{n}_{V2} \cdot \mathbf{n}_{V2}) \frac{
  n_3 + (1-n_3)^2 \ln(1-n_3)
}{
  36\pi n_3^2\left( 1 - n_3 \right)^2
} , \label{eq:Phi3}
\end{align}


\section{The convolution theorem}

One of the largest advantages to using Fundamental Measure Theory, and
one that is not immediately obvious, is that the convolutions that
combine to construct the functional allow for very efficient
computation.  This is not very intuitive, since an integral of a
convolution integral must integrate over two dimensions, e.g.
\begin{align}
\int(f\ast g)(\xx)d\xx = \int \int f(\yy)g(\xx-\yy)d\yy d\xx
\end{align}
so that it may seem that the size of the computation would scale as
$N^2$, where $N$ is the size of the system.  It is true that in the
case of FMT, the weighting functions cut off the integrals at the size
on the order of a sphere of particle radius, but this can still be a
large enough volume so that a double integral for which one of the
volumes is this size and the other is the size of the whole system
would be too costly for practical computation.  FMT is saved, however,
by what is called the Convolution Theorem.  The Convolution Theorem
states that when one takes the Fourier Transform on a spatial
convolution of two functions (a double integral in space), the result
is two separate integrals over k-space that are simply multiplied
together.  (SHOW IN EQ FORM) When minimizing our functional, after
taking a Fourier Transform of the convolutions, we have merely to
integrate once over the one variable $\kk$.  Wait!  You may say.  This
is a cheat, since the Fourier Transform is itself an integral, so at
the end of the day we're still performing two integrals.  This would
be true if it were not for the computational technique known as Fast
Fourier Transforms, developed by (cite).  I won't explain how it works
here, but it's effect is to perform the transform, which would
normally have a computational cost on the order of N, with a
computational cost on the order of $\ln N$ instead.  Thus, when we
Fourier Transform the convolutions in the functional and proceed to
take the single integral over the result (in k-space), the
computational cost scales as $N \ln N$.  For large systems (we
simulate systems with hundreds or even thousands of particles) this
can certainly be the difference between practically possible and
impossible computations.  The proof is short and pretty so I'll relate
it here:
\begin{align}
\hat{h}(\kk) = \hat{f}(\kk)\hat{g}(\kk)
\end{align}
Is the convolution theorem.  Proof:
\begin{align}
h(\xx) &= (f\ast g)(x) = \int f(\yy)g(\xx-\yy)d\yy \\
\hat{f}(\kk) &= \int f(\yy) exp(-i2\pi \kk \cdot \yy)d\yy \\
\hat{g}(\kk) &= \int g(\yy) exp(-i2\pi \kk \cdot \yy)d\yy \\
\int h(\rr) exp(-i2\pi \kk \cdot \zz) d\zz &= \int \int f(\yy) g(\zz-\yy) exp(-i2\pi \kk \cdot \zz) d\yy d\zz
\end{align}
because the two integrals are necessarily over all space,
\begin{align}
\xx &= \zz - \yy \\
\hat{h}(\kk) &= \int \int f(\yy) exp(-i2\pi \kk \cdot \yy ) d\yy g(\xx) exp(-i2\pi \kk \cdot \xx) d\xx \\
&= \hat{f}(\kk) \hat{g}(\kk)
\end{align}


\section{Contact Value Theorem}

Fixed number of particles:
\begin{align}
F &= U - TS \\
dU &= TdS -pdV \\
dF &= dU - TdS - SdT = -SdT - pdV
\end{align}
picture a fixed volume except a little protrusion into it, so call
$F_{out}$ and $F_{flat}$.  So looking at partition functions:
\begin{align}
Z_{flat} = \int_V... \int_V exp(-\phi \{\rr^N \})d\rr^N
Z_{out} =  \int_{V-dV}... \int_{V-dV} exp(-\phi \{\rr^N \})d\rr^N
\end{align}
Writing $Z_{flat}$ in terms of $Z_{out}$:
\begin{align}
Z_{flat} = &\int_{V-dV}... \int_{V-dV} exp(-\phi \{\rr^N \})d\rr^N \notag \\
+ &\int_V... \int_V \int_{V-dV} exp(-\phi \{ \rr^N \})d\rr^N \
+ \int_V ... \int_{V-dV} \int_V exp(-\phi \{ \rr^N \})d\rr^N ... \notag \\
+ &\int_V... \int_{V}\int_{V-dV} \int_{V-dV} exp(-\phi \{\rr^N \})d\rr^N \
+ \int_V... \int_{V-dV}\int_V \int_{V-dV} exp(-\phi \{\rr^N \})d\rr^N ...
\end{align}
The term on the first line is just $Z_{out}$.  The terms on the second
line treat one particle being in the bit of volume and the others
being integrated over the rest of the volume.  Becuase every particle
is identical, it doesn't matter which is in the little bit of volume,
each of these terms is the same.  So they can be replaced by one of
them multiplied by $N$.  The terms on the last line or any line after
are of order 2 or higher in $dV$.  We will throw away these terms, and
there are two arguments that allow us to do this.  The simplest one is
that $dV$ is small, and so terms with a two $dV$s multiplied together
will be small.  One must be careful with this, however, because one is
really intagrating over the boltzmann factor over these volumes.  If
the interaction potential between the particles is constructed so that
they are highly attracted to eachother, than a state in which there
are two particles in the bit of volume can have the same order of
magnitude probability as the one in which there is just one.  In this
case we would not be able to say for certain that these terms are so
much smaller than the order 1 $dV$ terms on the seconds line that we
could reasonably ignore them. Thus the validity of the derivation has
to do with the size of your smallest measurement along the wall, and
the nature of the attractive potentialbetween the particles.  In our
case we deal with an interaction between hard spheres, which simply
exclude other spheres from being too close to them.  Thus it's
reasonable for us to imagine that if there is one hard sphere in the
bit of volume, than there is only the one, and any terms that address
the situation in which there are two in the bit of volume can be
ignored.  After applying these areguments we have:
\begin{align}
  \label{eq:zflat}
  Z_{flat} = Z_{out} + N \int_V... \int_V \int_{V-dV} exp(-\phi \{ \rr^N \})d\rr^N
\end{align}

Now we consider the statistical mechanical definition of the particle
density,
\begin{align}
  n(\rr) = \frac{N \int_V... \int_V exp(-\phi \{ \rr^N \})d\rr^{N-1}}{\int_V... \int_V exp(-\phi \{ \rr^N \})d\rr^N}
\end{align}
Which is the sum of the boltzmann factors of all the states for which
a particle is at position $\rr$, divided by the partition function for
the system.  Comparing this with the right-most term in the
Eq.~\ref{eq:zflat} we see that:
\begin{align}
 N \int_V... \int_V \int_{V-dV} exp(-\phi \{ \rr^N \})d\rr^N  &= Z_{flat} \int_{dV} n(\rr) d\rr
 &\approx Z_{flat} n(\rr)dV
\end{align}
where on the right we make the approximation that because the volume
is small $n(\rr)$ is constant over it.
Thus we have
\begin{align}
Z_{flat} = Z_{out} + Z_{flat} n(\rr)dV \\
Z_{out} = Z_{flat} (1-n(\rr)dV)
\end{align}

We have
\begin{align}
  dF = F_{out} - F_{flat} &= -kT \ln \left( \frac{Z_{out}}{Z_{flat}} \right) \notag \\
  &= -kT \ln \left( \frac{Z_{flat} (1-n(\rr)dV)}{Z_{flat}} \right) \notag \\
  &= -kT \ln \left( 1-n(\rr)dV \right) \notag \\
  &= kTn(\rr)dV
\end{align}
Then relating back to thermodynamics:
\begin{align}
  pdV &= dF = ktn(\rr)dV \\
  \label{eq:contact-value-theorem}
  p &= ktn(\rr)
\end{align}
Eq.~\ref{eq:contact-value-theorem} is the standard formulation of the
contact value theorem.


Another equation for the particle density is:
\begin{align}
n(\rr) = \frac{\delta \iF}{\delta V_{ext}}
\end{align}

\clearpage
\newpage




\section{Remaining terms in SAFT}
